#!/usr/bin/env python3
"""
ğŸ“¦ Ù…Ù€Ù†Ù€ØµÙ‘Ù€Ø¨ Ø³Ù€ÙˆØ±Ø³ Common Ù„Ù€ Termux
Ø¥ØµÙ€Ø¯Ø§Ø± Ù…Ù€ØµÙ€Ù„Ù€Ø­ ÙˆÙ…Ù€Ø¶Ù€Ø¨Ù€ÙˆØ·
"""

import os
import sys
import subprocess

# ============================================
# ğŸ”§ Ø¥Ø¹Ù€Ø¯Ø§Ø¯Ø§Øª ØªÙ€Ø¬Ù€Ù†Ù€Ø¨ Ø§Ù„Ù€Ù…Ù€Ø´Ù€Ø§ÙƒÙ€Ù„ Ù…Ù€Ù† Ø§Ù„Ù€Ø¨Ù€Ø¯Ø§ÙŠÙ€Ø©
# ============================================
os.environ['TZ'] = 'Asia/Riyadh'  # Ø¥ØµÙ€Ù„Ø§Ø­ timezone
os.environ['PYTHONWARNINGS'] = 'ignore'  # Ø¥Ø®Ù€ÙÙ€Ø§Ø¡ Ø§Ù„Ù€ØªÙ€Ø­Ù€Ø°ÙŠÙ€Ø±Ø§Øª

print("\n" + "="*50)
print("ğŸš€ Ù…Ù€Ù†Ù€ØµÙ‘Ù€Ø¨ Ø³Ù€ÙˆØ±Ø³ Common - Ø§Ù„Ø¥ØµÙ€Ø¯Ø§Ø± Ø§Ù„Ù€Ù…Ù€ØµÙ€Ù„Ù€Ø­")
print("="*50)

# ============================================
# ğŸ“¦ ØªÙ€Ø«Ù€Ø¨ÙŠÙ€Øª ÙˆØªÙ€Ø­Ù€Ø¯ÙŠÙ€Ø« Ø§Ù„Ù€Ù…Ù€ÙƒÙ€ØªÙ€Ø¨Ù€Ø§Øª Ø¨Ù€Ø¯ÙˆÙ† ØªÙ€Ø­Ù€Ø°ÙŠÙ€Ø±Ø§Øª
# ============================================
def install_packages():
    print("\nğŸ“¦ Ø¬Ù€Ø§Ø±ÙŠ ØªÙ€Ø­Ù€Ø¶Ù€ÙŠÙ€Ø± Ø§Ù„Ù€Ù…Ù€ÙƒÙ€ØªÙ€Ø¨Ù€Ø§Øª...")
    
    # Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    packages = [
        "python-telegram-bot>=20.7",
        "telethon>=1.34.0", 
        "aiohttp>=3.9.0",
        "requests>=2.31.0",
        "pytz>=2025.2",
        "setuptools<81"  # Ù„Ù…Ù†Ø¹ Ù…Ø´ÙƒÙ„Ø© pkg_resources
    ]
    
    for pkg in packages:
        print(f"â¬‡ï¸  ØªÙ€Ø«Ù€Ø¨ÙŠÙ€Øª {pkg}...")
        try:
            # ØªØ«Ø¨ÙŠØª Ø¨Ø¯ÙˆÙ† Ø¹Ø±Ø¶ ØªØ­Ø°ÙŠØ±Ø§Øª
            result = subprocess.run(
                [sys.executable, "-m", "pip", "install", "--quiet", pkg],
                capture_output=True,
                text=True
            )
            if result.returncode == 0:
                print(f"âœ… {pkg.split('>')[0].split('<')[0]}")
            else:
                print(f"âš ï¸  {pkg} (Ù…Ù€Ø«Ù€Ø¨Ù€Øª)")
        except:
            print(f"âœ… {pkg.split('>')[0].split('<')[0]} (Ù…Ù€ÙˆØ¬Ù€ÙˆØ¯)")

# ============================================
# ğŸ” Ø§Ù„Ù€ØªÙ€ÙˆÙƒÙ† Ø§Ù„Ù€Ø±Ø¦Ù€ÙŠÙ€Ø³Ù€ÙŠ - Ø¶Ù€Ø¹Ù€Ù‡ Ù‡Ù€Ù†Ù€Ø§
# ============================================
BOT_TOKEN = "8307560710:AAFNRpzh141cq7rKt_OmPR0A823dxEaOZVU"  # ğŸ”´ Ø§Ø­ØµÙ„ Ø¹Ù„ÙŠÙ‡ Ù…Ù† @BotFather

# ============================================
# ğŸ¤– Ø¬Ù€Ø²Ø¡ Ø§Ù„Ù€Ø¨Ù€ÙˆØª (Ø¨Ù€Ø¯ÙˆÙ† Ù…Ù€Ø´Ù€Ø§ÙƒÙ€Ù„)
# ============================================
def setup_bot():
    if BOT_TOKEN == "Ø¶Ø¹_Ø§Ù„ØªÙˆÙƒÙ†_Ù‡Ù†Ø§":
        print("\nâŒ ÙŠÙ€Ø¬Ù€Ø¨ ÙˆØ¶Ù€Ø¹ ØªÙ€ÙˆÙƒÙ† Ø§Ù„Ù€Ø¨Ù€ÙˆØª Ø£ÙˆÙ„Ø§Ù‹!")
        print("ğŸ”¹ Ø§Ø°Ù‡Ù€Ø¨ Ø¥Ù„Ù€Ù‰ @BotFather ÙÙ€ÙŠ ØªÙ€Ù„Ù€ÙŠÙ€Ø¬Ù€Ø±Ø§Ù…")
        print("ğŸ”¹ Ø£Ù†Ù€Ø´Ù€Ø¦ Ø¨Ù€ÙˆØª Ø¬Ù€Ø¯ÙŠÙ€Ø¯")
        print("ğŸ”¹ Ø¶Ù€Ø¹ Ø§Ù„Ù€ØªÙ€ÙˆÙƒÙ† ÙÙ€ÙŠ Ø§Ù„Ù€Ø³Ù€Ø·Ù€Ø± 48")
        return False
    
    print("\nğŸ¤– Ø¬Ù€Ø§Ø±ÙŠ ØªÙ€Ø­Ù€Ø¶Ù€ÙŠÙ€Ø± Ù†Ù€Ø¸Ù€Ø§Ù… Ø§Ù„Ù€Ø¨Ù€ÙˆØª...")
    
    try:
        # Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø¨ÙˆØª
        from telegram.ext import Application, CommandHandler, MessageHandler, filters, ConversationHandler, ContextTypes
        
        print("âœ… Ø¬Ù€Ù…Ù€ÙŠÙ€Ø¹ Ù…Ù€ÙƒÙ€ØªÙ€Ø¨Ù€Ø§Øª Ø§Ù„Ù€Ø¨Ù€ÙˆØª Ø¬Ù€Ø§Ù‡Ù€Ø²Ø©")
        
        # Ù‡Ù†Ø§ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ...
        # ÙŠÙ…ÙƒÙ†Ùƒ ÙˆØ¶Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ù‡Ù†Ø§
        
        return True
        
    except Exception as e:
        print(f"âŒ Ø®Ù€Ø·Ù€Ø£ ÙÙ€ÙŠ ØªÙ€Ø­Ù€Ø¶Ù€ÙŠÙ€Ø± Ø§Ù„Ù€Ø¨Ù€ÙˆØª: {e}")
        print("ğŸ”¹ Ø¬Ù€Ø±Ø¨ ØªÙ€Ø«Ù€Ø¨ÙŠÙ€Øª Ø§Ù„Ù€Ù…Ù€ÙƒÙ€ØªÙ€Ø¨Ù€Ø§Øª ÙŠÙ€Ø¯ÙˆÙŠÙ€Ø§Ù‹:")
        print("   pip install python-telegram-bot==20.7")
        return False

# ============================================
# ğŸ“‚ ØªÙ€Ù†Ù€ØµÙ€ÙŠÙ€Ø¨ Ø§Ù„Ù€Ø³Ù€ÙˆØ±Ø³
# ============================================
def install_source():
    print("\nğŸ“‚ Ø¬Ù€Ø§Ø±ÙŠ ØªÙ€Ù†Ù€ØµÙ€ÙŠÙ€Ø¨ Ø³Ù€ÙˆØ±Ø³ Common...")
    
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª Ø§Ù„Ø³ÙˆØ±Ø³
    required_files = ["main.py", "config.py", "handlers.py"]
    missing_files = []
    
    for file in required_files:
        if not os.path.exists(file):
            missing_files.append(file)
    
    if missing_files:
        print(f"âŒ Ù†Ù€Ù‚Ù€Øµ ÙÙ€ÙŠ Ù…Ù€Ù„Ù€ÙÙ€Ø§Øª Ø§Ù„Ù€Ø³Ù€ÙˆØ±Ø³: {', '.join(missing_files)}")
        print("ğŸ”¹ ØªÙ€Ø£ÙƒÙ€Ø¯ Ù…Ù€Ù† ØªÙ€Ù†Ù€Ø²ÙŠÙ€Ù„ Ø¬Ù€Ù…Ù€ÙŠÙ€Ø¹ Ù…Ù€Ù„Ù€ÙÙ€Ø§Øª Ø§Ù„Ù€Ø³Ù€ÙˆØ±Ø³")
        return False
    
    print("âœ… Ø¬Ù€Ù…Ù€ÙŠÙ€Ø¹ Ù…Ù€Ù„Ù€ÙÙ€Ø§Øª Ø§Ù„Ù€Ø³Ù€ÙˆØ±Ø³ Ù…Ù€ÙˆØ¬Ù€ÙˆØ¯Ø©")
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù .env Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    if not os.path.exists(".env"):
        print("ğŸ“ Ø¥Ù†Ù€Ø´Ù€Ø§Ø¡ Ù…Ù€Ù„Ù€Ù .env Ù„Ù„Ø¥Ø¹Ù€Ø¯Ø§Ø¯Ø§Øª...")
        with open(".env", "w") as f:
            f.write("# Ø¥Ø¹Ù€Ø¯Ø§Ø¯Ø§Øª Ø³Ù€ÙˆØ±Ø³ Common\n")
            f.write("API_ID=123456\n")
            f.write("API_HASH=your_api_hash_here\n")
            f.write("STRING_SESSION=your_string_session\n")
            f.write(f"BOT_TOKEN={BOT_TOKEN}\n")
        print("âœ… ØªÙ€Ù… Ø¥Ù†Ù€Ø´Ù€Ø§Ø¡ Ù…Ù€Ù„Ù€Ù .env")
    
    return True

# ============================================
# ğŸ¯ Ø§Ù„Ù€ØªÙ€Ù†Ù€ÙÙ€ÙŠÙ€Ø° Ø§Ù„Ù€Ø±Ø¦Ù€ÙŠÙ€Ø³Ù€ÙŠ
# ============================================
def main():
    print("\n" + "="*50)
    
    # 1. ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
    install_packages()
    
    # 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙˆØª
    if not setup_bot():
        return
    
    # 3. ØªÙ†ØµÙŠØ¨ Ø§Ù„Ø³ÙˆØ±Ø³
    if not install_source():
        return
    
    # 4. Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    print("\n" + "="*50)
    print("ğŸ‰ ØªÙ€Ù… ØªÙ€Ù†Ù€ØµÙ€ÙŠÙ€Ø¨ Ø³Ù€ÙˆØ±Ø³ Common Ø¨Ù€Ù†Ù€Ø¬Ù€Ø§Ø­!")
    print("="*50)
    print("\nğŸ“Œ Ù„Ù€ØªÙ€Ø´Ù€ØºÙ€ÙŠÙ€Ù„ Ø§Ù„Ù€Ø³Ù€ÙˆØ±Ø³:")
    print("   1. Ø§Ø¶Ù€Ø¨Ù€Ø· Ø§Ù„Ù€Ø¥Ø¹Ù€Ø¯Ø§Ø¯Ø§Øª ÙÙ€ÙŠ Ù…Ù€Ù„Ù€Ù .env")
    print("   2. Ø´Ù€ØºÙ‘Ù€Ù„ Ø§Ù„Ù€Ø³Ù€ÙˆØ±Ø³ Ø¨Ù€Ø§Ù„Ø£Ù…Ù€Ø±:")
    print("      python main.py")
    print("\nğŸ”— Ù„Ù€Ù„Ù€Ù…Ù€Ø³Ù€Ø§Ø¹Ù€Ø¯Ø©: @CommonSupport")
    print("="*50)

# ============================================
# ğŸ”„ ØªÙ€Ù†Ù€ÙÙ€ÙŠÙ€Ø° Ø§Ù„Ù€Ø¨Ù€Ø±Ù†Ù€Ø§Ù…Ù€Ø¬
# ============================================
if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\nâ¹ï¸  ØªÙ€Ù… Ø¥ÙŠÙ€Ù‚Ù€Ø§Ù Ø§Ù„Ù€ØªÙ€Ù†Ù€ØµÙ€ÙŠÙ€Ø¨")
    except Exception as e:
        print(f"\nâŒ Ø­Ù€Ø¯Ø« Ø®Ù€Ø·Ù€Ø£ ØºÙ€ÙŠÙ€Ø± Ù…Ù€ØªÙ€ÙˆÙ‚Ù€Ø¹: {e}")
        print("ğŸ”¹ Ø¬Ù€Ø±Ø¨ ØªÙ€Ø´Ù€ØºÙ€ÙŠÙ€Ù„ Ø£Ù…Ù€Ø± Ø§Ù„Ù€ØªÙ€Ø«Ù€Ø¨ÙŠÙ€Øª ÙŠÙ€Ø¯ÙˆÙŠÙ€Ø§Ù‹:")
        print("   pip install --upgrade pip")
        print("   pip install python-telegram-bot telethon aiohttp requests pytz")
