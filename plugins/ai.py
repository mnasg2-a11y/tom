# plugins/ai_single.py
from telethon import events
import aiohttp
import json
import random
from __main__ import client # ุงุณุชูุฑุงุฏ ุงูุนููู ุงูุฃุณุงุณู ูุถูุงู ุงูุนูู

# --- ุจูุงูุงุช ููุฑุณุฉ ุงูุณูุฑุณ (ุถุฑูุฑูุฉ ููุธูุฑ ูู ุงููุงุฆูุฉ) ---
SECTION_NAME = "๐ง ูุณู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุทูุฑ"
COMMANDS = "โข `.ุฐูุงุก` : ููุญุฉ ุงูุชุญูู ุงูุฐููุฉ ุงูุดุงููุฉ (20 ููุฒุฉ)"

# =========================================================
# ๐ฏ ูุญุฑู ูุนุงูุฌุฉ ุงูุจูุงูุงุช (Gemini 2.0 Flash Lite)
# =========================================================

async def ask_gemini(prompt):
    """ุงูุงุชุตุงู ุงููุจุงุดุฑ ุจูุญุฑู ุงูุฐูุงุก ูู ูููุงุชู"""
    api_url = "https://firebasevertexai.googleapis.com/v1beta/projects/gemmy-ai-bdc03/locations/us-central1/publishers/google/models/gemini-2.0-flash-lite:generateContent"
    headers = {
        'User-Agent': "Ktor client", 
        'Content-Type': "application/json", 
        'x-goog-api-key': "AIzaSyD6QwvrvnjU7j-R6fkOghfIVKwtvc7SmLk", 
        'x-goog-api-client': "gl-kotlin/2.2.0-ai fire/16.5.0", 
        'x-firebase-appid': "1:652803432695:android:c4341db6033e62814f33f2"
    }
    payload = {
        "contents": [{"role": "user", "parts": [{"text": prompt}]}]
    }
    try:
        async with aiohttp.ClientSession() as session:
            async with session.post(api_url, json=payload, headers=headers, timeout=30) as resp:
                if resp.status == 200:
                    res = await resp.json()
                    return res['candidates'][0]['content']['parts'][0]['text'].strip()
    except: return None

# =========================================================
# ๐ ุงูุฃูุฑ ุงูุฑุฆูุณู ูู ุญุณูู (20 ููุฒุฉ ูุฏูุฌุฉ)
# =========================================================

@client.on(events.NewMessage(outgoing=True, pattern=r'\.ุฐูุงุก'))
async def ai_master_command(event):
    # ุนุฑุถ ุงูููุญุฉ ุฅุฐุง ูุชุจ .ุฐูุงุก ููุท
    if " " not in event.text:
        menu = (
            "โโโโโโโโโโโโโโโโโโโโโโ\n"
            "      **๐ง ุฐูุงุก ูููููู  P R O**\n"
            "โโโโโโโโโโโโโโโโโโโโโโ\n\n"
            "๐ **ุงุณุชุฎุฏู: `.ุฐูุงุก [ุงูุฃูุฑ] [ูุต]`**\n\n"
            "1. `ุณุคุงู` 2. `ุตูุฑุฉ` 3. `ููุฏ` 4. `ููุงู` \n"
            "5. `ุชุฑุฌู` 6. `ูุฎุต` 7. `ุญู` 8. `ุงููุงุฑ` \n"
            "9. `ุชุนูู` 10. `ูุตุฉ` 11. `ุดุนุฑ` 12. `ุชุตููู` \n"
            "13. `ุฎุทุท` 14. `ุงุฎุชุจุฑ` 15. `ุญููุฉ` 16. `ุชุญููู` \n"
            "17. `ุงุจุชูุงุฑ` 18. `ุดุฑุญ` 19. `ุชุตุญูุญ` 20. `ุชุญุณูู` \n"
            "โโโโโโโโ โ โโโโโโโโ\n"
            "๐ **S O U R C E  C O M M O N**"
        )
        return await event.edit(menu)

    # ูุนุงูุฌุฉ ุงููุฏุฎูุงุช
    input_data = event.text.replace('.ุฐูุงุก ', '').split(maxsplit=1)
    if len(input_data) < 2 and input_data[0] != 'ุญููุฉ':
        return await event.edit("โ๏ธ **ูุฑุฌู ูุชุงุจุฉ ูุต ุจุนุฏ ุงูุฃูุฑ (ูุซุงู: .ุฐูุงุก ุณุคุงู ูู ุฃูุชุ)**")

    cmd = input_data[0]
    user_text = input_data[1] if len(input_data) > 1 else ""
    await event.edit(f"๐ **ุฌูุงุฑู ููุนูุงูุฌุฉ `{cmd}` ุนุจุฑ Gemini...**")

    # ุฎุฑูุทุฉ ุงูุฃูุงูุฑ ุงูู 20 ุงููุฏูุฌุฉ ูุน AI
    prompts = {
        'ุณุคุงู': f"ุฃุฌุจ ุจุฐูุงุก: {user_text}",
        'ุตูุฑุฉ': f"ุตู ุตูุฑุฉ ุงุญุชุฑุงููุฉ ูู: {user_text}",
        'ููุฏ': f"ุงูุชุจ ููุฏ ุจุฑูุฌู ูุธูู ูู: {user_text}",
        'ููุงู': f"ุงูุชุจ ููุงูุงู ุทูููุงู ูููุณูุงู ุนู: {user_text}",
        'ุชุฑุฌู': f"ุชุฑุฌู ุงููุต ุงูุชุงูู ููุนุฑุจูุฉ ุจุฏูุฉ: {user_text}",
        'ูุฎุต': f"ูุฎุต ูุฐุง ุงููุต ุจุฃุณููุจ ููุงุท: {user_text}",
        'ุญู': f"ูุฏู ุญูุงู ููุทููุงู ููุฐู ุงููุดููุฉ: {user_text}",
        'ุงููุงุฑ': f"ุฃุนุทูู 5 ุฃููุงุฑ ุฅุจุฏุงุนูุฉ ูู: {user_text}",
        'ุชุนูู': f"ุงุดุฑุญ ูู ูุฐุง ุงูููุถูุน ูุฃููู ุทูู: {user_text}",
        'ูุตุฉ': f"ุงูุชุจ ูุตุฉ ูุตูุฑุฉ ูุดููุฉ ุนู: {user_text}",
        'ุดุนุฑ': f"ุงูุชุจ ุฃุจูุงุช ุดุนุฑูุฉ ูุตูุญุฉ ุนู: {user_text}",
        'ุชุตููู': f"ุฎุทุท ูุชุตููู ุฌุฑุงูููู ูู: {user_text}",
        'ุฎุทุท': f"ุงุฑุณู ูู ุฎุทุฉ ุนูู ูุงุฌุญุฉ ูู: {user_text}",
        'ุงุฎุชุจุฑ': f"ุงุทุฑุญ ุนูู ุณุคุงูุงู ุตุนุจุงู ูู: {user_text}",
        'ุญููุฉ': "ุฃุนุทูู ุญููุฉ ุนุงูููุฉ ูุงุฏุฑุฉ.",
        'ุชุญููู': f"ุญูู ุงูุจูุงูุงุช ุงูุชุงููุฉ ุชุญูููุงู ุฏูููุงู: {user_text}",
        'ุงุจุชูุงุฑ': f"ุงูุชุฑุญ ุงุจุชูุงุฑุงู ุชูููุงู ุฌุฏูุฏุงู ูู: {user_text}",
        'ุดุฑุญ': f"ุงุดุฑุญ ูู ููุฏ ุฃู ููุทู: {user_text}",
        'ุชุตุญูุญ': f"ุตุญุญ ุงูุฃุฎุทุงุก ูู ูุฐุง ุงููุต ุฃู ุงูููุฏ: {user_text}",
        'ุชุญุณูู': f"ููู ูููููู ุชุญุณูู ุฌูุฏุฉ: {user_text}"
    }

    if cmd in prompts:
        response = await ask_gemini(prompts[cmd])
        res_msg = (
            f"โโโโโโโโโโโโโโโโโโโโโโ\n"
            f"      **โจ ููุชูููุฌูุฉ ุงููุฐููุงุก ({cmd})**\n"
            f"โโโโโโโโโโโโโโโโโโโโโโ\n\n"
            f"โข {response if response else 'ุนุฐุฑุงู ุญุณููุ ุงููุญุฑู ูุดุบูู ุญุงููุงู.'}\n"
            f"โโโโโโโโ โ โโโโโโโโ\n"
            f"๐ **S O U R C E  C O M M O N**"
        )
        await event.edit(res_msg)
    else:
        await event.edit("โ **ุงูุฃูุฑ ุบูุฑ ููุฌูุฏ ูู ุงููุงุฆูุฉ.**")
